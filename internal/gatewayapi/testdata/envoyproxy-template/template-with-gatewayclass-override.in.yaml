# Test case: Template with GatewayClass-level override
# This test verifies that GatewayClass-level EnvoyProxy settings override
# the template, with explicit fields from GatewayClass taking precedence.

envoyGateway:
  apiVersion: gateway.envoyproxy.io/v1alpha1
  kind: EnvoyGateway
  gateway:
    controllerName: gateway.envoyproxy.io/gatewayclass-controller
  provider:
    type: Kubernetes
    kubernetes:
      envoyProxyTemplate:
        provider:
          type: Kubernetes
          kubernetes:
            envoyDeployment:
              replicas: 3
              container:
                env:
                - name: TEMPLATE_ENV
                  value: template_value
                resources:
                  requests:
                    cpu: 200m
                    memory: 1Gi
              pod:
                annotations:
                  template-annotation: template-value
                tolerations:
                - key: template-key
                  operator: Exists

envoyProxyForGatewayClass:
  apiVersion: gateway.envoyproxy.io/v1alpha1
  kind: EnvoyProxy
  metadata:
    name: gatewayclass-proxy
    namespace: envoy-gateway-system
  spec:
    provider:
      type: Kubernetes
      kubernetes:
        envoyDeployment:
          replicas: 5
          container:
            env:
            - name: GATEWAYCLASS_ENV
              value: gatewayclass_value
            image: "envoyproxy/envoy:v1.28.0"
          pod:
            annotations:
              gatewayclass-annotation: gatewayclass-value
